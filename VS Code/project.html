
<!DOCTYPE HTML> 
<html> 
 
<head>
    <title>
        Museum JSON data to a
        html table using JavaScript
    </title>
     
    <script src=
"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js">
    </script>
</head>
 
<body style = "text-align:center;" id = "body"> 
     
    <h1 style = "color:black;" > 
        Museum Table 
    </h1>
     
    <p id = "GFG_UP" style =
        "font-size: 15px; font-weight: bold;">
    </p>
 
     
    <button onclick = "constructTable('#table')">
        view Table
    </button>

    <!-- <button onclick = onclick = "onInsert({JSON.stringify(list[1]).replace(/\s+/g, '')})">
        insert
    </button> -->
    
    <div id = "azuga"></div>
    <div id = "division"></div>
     
    <br><br>
     
    <table align = "center"
            id="table" border="1">
    </table>


    
    <script>
      
       var list;
       var url = "http://localhost:8080/frontend/webapi/myresource/select";
       $.getJSON(url , function(mylist){
           list=mylist;
       });
             
       function constructTable(selector) {
             
            // Getting the all column names
            var cols = Headers(list, selector); 
  
            // Traversing the JSON data
            for (var i = 0; i < list.length; i++) {
                var row = $('<tr/>');  
                for (var colIndex = 0; colIndex < cols.length; colIndex++)
                {
                    var val = list[i][cols[colIndex]];
                    // If there is any key, which is matching
                    // with the column name
                    if (val == null) val = ""; 
                        row.append($('<td/>').html(val));
                }

                row.append($(`<button onclick = onDelete(${JSON.stringify(list[i]).replace(/\s+/g, '')})/>`).html("delete"));
                row.append($(`<button onclick = onUpdate(${JSON.stringify(list[i]).replace(/\s+/g, '')})/>`).html("Update"));

                 
                // Adding each row to the table
                $(selector).append(row);
            }
            $("#azuga").append($(`<button onclick = onInsert(${JSON.stringify(list[0]).replace(/\s+/g, '')})/>`).html("insert"));

        }
        
        // $("azuga").append($(`<button onclick = onInsert(${JSON.stringify(list[1]).replace(/\s+/g, '')})/>`).html("insert"));
        // $("#azuga").append($(`<button onclick = onInsert(${JSON.stringify(list[1]).replace(/\s+/g, '')})/>`).html("insert"));

        function Headers(list, selector) {
            var columns = [];
            var header = $('<tr/>');
             
            for (var i = 0; i < list.length; i++) {
                var row = list[i];
                 
                for (var k in row) {
                    if ($.inArray(k, columns) == -1) {
                        columns.push(k);
                         
                        // Creating the header
                        header.append($('<th/>').html(k));
                    }
                }
            }
            header.append($('<th/>').html("Action"));
        
             
            // Appending the header to the table
            $(selector).append(header);
                return columns;
        }      
        function Buttons(list, selector) {
           var buttons = [];
           $append

        }
        function onDelete(td) {
        //    row = td.parentElement.parentElement;
            let id="";
        //     console.log(id);
            Object.entries(td).forEach(([key , value])=> {
                if(key == "objectID"){
                   id = value;
                }
            });
            fetch('http://localhost:8080/frontend/webapi/myresource/delete/'+id,{
            method: "DELETE",
            headers: {
            'content-type': 'application/json'
            }
           })
           .then(res => {
           if(res.ok){console.log("delete request successful")}
           else{console.log("delete request unsuccessful")}
           return res
           })
           .then(res => console.log(res))
           document.getElementById("employeeList").deleteRow(row.rowIndex);
           resetForm();

        }
        
        function onUpdate(up) {
            var form = $('<div/>')
            Object.entries(up).forEach(([key, value])=> {
                
                
            form.append($("<label/>").text(key).html(key));
            form.append($("<br/>"));
                    var val = `${JSON.stringify(value)}`;
                    var v = val.replace("\"","").replace("\"","");
                form.append($('<input type="text"/>').attr({id:key, name:key, value:v}).html(v));
                form.append($("<br/>"));
            });
            form.append($(`<button onclick = update(${JSON.stringify(up)})>submit</button>`));
            $("#division").append(form).html;
            
        }
        function onInsert(up) {
            var form = $('<div/>')
            Object.entries(up).forEach(([key, value])=> {
                
                
            form.append($("<label/>").text(key).html(key));
            form.append($("<br/>"));
                    var val = `${JSON.stringify(value)}`;
                    var v = val.replace("\"","").replace("\"","");
                form.append($('<input type="text"/>').attr({id:key, name:key}).html(v));
                form.append($("<br/>"));
            });
            form.append($(`<button onclick = insert(${JSON.stringify(up)})>submit</button>`));
            $("#azuga").append(form).html;
        }
        function update(data){
             console.log(data);
             let str = "{";
             let id = "";

             Object.entries(data).forEach(([key , value])=>{
                if(key == "objectID"){
                    id = value;
                }
                var val = document.getElementById(key).value;
                str+=`"${key}" :"${val}",`;
             });
             str += "}";
             var json = str.replace(",}","}");
             console.log(json);
             fetch("http://localhost:8080/frontend/webapi/myresource/update/" + id, {
                method: "PUT",
                mode: "cors",
                Headers: {
                    'Content-Type': 'text/plain'
                },
                body: json
            })
                .then((res) => {
                    // if (res.ok) {
                    //     console.log("http request successful")
                    // } else {
                    //     console.log("http request unsuccessful")
                    // }
                    return res;
                }).then(data => alert(data)).catch((err) =>{ alert(err);console.log(err)});

        }
        function insert(data){
            console.log(data);
             let str = "{";
             let id = "";

             Object.entries(data).forEach(([key , value])=>{
                if(key == "objectID"){
                    id = value;
                }
                var val = document.getElementById(key).value;
                str+=`"${key}" :"${val}",`;
             });
             str += "}";
             var json = str.replace(",}","}");
             console.log(json);
             fetch("http://localhost:8080/frontend/webapi/myresource/insert", {
                method: "POST",
                mode: "no-cors",
                Headers: {
                    'Content-Type': 'text/plain'
                },
                body: json
            })
                .then((res) => {
                    // if (res.ok) {
                    //     console.log("http request successful")
                    // } else {
                    //     console.log("http request unsuccessful")
                    // }
                    return res;
                }).then(data => alert(data)).catch((err) =>{ alert(err);console.log(err)});
        }
    </script>
</body> 
 
</html>